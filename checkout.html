<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <nav>
      <!-- copy nav kamu -->
    </nav>

    <div class="content">
      <h1>Checkout</h1>

      <div id="cart-items"></div>

      <h2>Payment Details</h2>
      <input
        type="text"
        id="name"
        placeholder="Nama Anda"
        required
      /><br /><br />
      <input type="email" id="email" placeholder="Email" required /><br /><br />
      <button onclick="checkout()">Bayar Sekarang</button>
      <button onclick="history.go(-1)">Back</button>
    </div>

    <div
      id="success-modal"
      style="
        display: none;
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 10px;
      "
    >
      <h2>Pembayaran Berhasil!</h2>
      <button onclick="closeModal('success-modal')">Tutup</button>
    </div>

    <div
      id="fail-modal"
      style="
        display: none;
        position: fixed;
        top: 30%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 10px;
      "
    >
      <h2>Pembayaran Gagal!</h2>
      <button onclick="closeModal('fail-modal')">Tutup</button>
    </div>

    <script>
      function loadCart() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        let cartHTML = "<ul>";
        cart.forEach((item) => {
          cartHTML += `<li>${item.name} - $${item.price} x ${item.quantity}</li>`;
        });
        cartHTML += "</ul>";
        document.getElementById("cart-items").innerHTML = cartHTML;
      }

      function checkout() {
        const random = Math.random();
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const total = cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );

        window.dataLayer = window.dataLayer || [];

        if (random > 0.5) {
          document.getElementById("success-modal").style.display = "block";

          window.dataLayer.push({
            event: "purchase_success",
            ecommerce: {
              transaction_id: Date.now(),
              value: total,
              currency: "USD",
              items: cart.map((item) => ({
                item_id: "dest_" + item.name.replace(/\s/g, "").toLowerCase(),
                item_name: item.name,
                price: item.price,
                item_category: item.location,
                quantity: item.quantity,
              })),
            },
          });

          localStorage.removeItem("cart");
        } else {
          document.getElementById("fail-modal").style.display = "block";

          window.dataLayer.push({
            event: "purchase_fail",
          });
        }
      }

      function closeModal(id) {
        document.getElementById(id).style.display = "none";
        window.location.href = "index.html";
      }

      window.onload = loadCart;
    </script>
  </body>
</html>
